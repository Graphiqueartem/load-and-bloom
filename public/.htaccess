
RewriteEngine On

# Force HTTPS (optional - uncomment if you want to force SSL)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Set proper headers for API responses
<FilesMatch "\.(php)$">
    Header set Content-Type "application/json; charset=utf-8"
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
</FilesMatch>

# Handle preflight OPTIONS requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Handle API routes first - redirect to the API folder
RewriteRule ^api/(.*)$ api/$1 [L,QSA]

# Handle file uploads
RewriteRule ^uploads/(.*)$ uploads/$1 [L]

# Handle React Router - redirect all non-file, non-API requests to index.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/api/
RewriteCond %{REQUEST_URI} !^/uploads/
RewriteRule . /index.html [L]
